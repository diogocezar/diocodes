generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mongodb"
    url      = env("URI_MONGODB")
}

enum Role {
    ADMIN
    USER
}

model Person {
    id                String      @id @default(uuid()) @map("_id")
    name              String
    email             String      @unique
    user              User?
    hostMentoring     Mentoring[] @relation("host_mentoring")
    attendeeMentoring Mentoring[] @relation("atendee_mentoring")
    attendeeInvite    Invite[]    @relation("attendee_invite")
    createdAt         DateTime    @default(now())
    updatedAt         DateTime?
    removedAt         DateTime?
}

model User {
    id        String    @id @default(uuid()) @map("_id")
    person    Person    @relation(fields: [personId], references: [id])
    personId  String    @unique
    role      Role      @default(USER)
    createdAt DateTime  @default(now())
    updatedAt DateTime?
    removedAt DateTime?
}

model Tag {
    id             String           @id @default(uuid()) @map("_id")
    name           String
    createdAt      DateTime         @default(now())
    updatedAt      DateTime?
    removedAt      DateTime?
    avaliationTags AvaliationTags[]
}

model AvaliationTags {
    id           String      @id @default(uuid()) @map("_id")
    avaliation   Avaliation? @relation(fields: [avaliationId], references: [id])
    avaliationId String?
    tag          Tag?        @relation(fields: [tagId], references: [id])
    tagId        String?
    createdAt    DateTime    @default(now())
    updatedAt    DateTime?
    removedAt    DateTime?
}

model Avaliation {
    id             String           @id @default(uuid()) @map("_id")
    mentoring      Mentoring        @relation(fields: [mentoringId], references: [id])
    mentoringId    String           @unique
    rating         Int
    avaliationTags AvaliationTags[]
    comment        String?
    wasSent        Boolean          @default(false)
    createdAt      DateTime         @default(now())
    updatedAt      DateTime?
    removedAt      DateTime?
}

model Mentoring {
    id         String      @id @default(uuid()) @map("_id")
    host       Person      @relation("host_mentoring", fields: [hostId], references: [id])
    hostId     String
    attendee   Person      @relation("atendee_mentoring", fields: [attendeeId], references: [id])
    attendeeId String
    startTime  DateTime
    endTime    DateTime
    avaliation Avaliation?
    invite     Invite[]
    createdAt  DateTime    @default(now())
    updatedAt  DateTime?
    removedAt  DateTime?
}

model Invite {
    id          String    @id @default(uuid()) @map("_id")
    mentoring   Mentoring @relation(fields: [mentoringId], references: [id])
    mentoringId String
    attendee    Person    @relation("attendee_invite", fields: [attendeeId], references: [id])
    attendeeId  String
    token       String?
    createdAt   DateTime  @default(now())
    updatedAt   DateTime?
    removedAt   DateTime?
}
